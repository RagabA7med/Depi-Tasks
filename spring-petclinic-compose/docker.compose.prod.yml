version: "3.8"

services:
  db:
    image: mysql:8.4
    env_file:
      - .env.sql
    volumes:
      - mysqldata:/var/lib/mysql
    command: >
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
    healthcheck:
      test: ["CMD-SHELL","mysqladmin ping -h 127.0.0.1 -u$$MYSQL_USER -p$$MYSQL_PASSWORD || mysqladmin ping -h 127.0.0.1 -uroot -p$$MYSQL_ROOT_PASSWORD"]

  app:
    env_file:
      - .env.sql

volumes:
  mysqldata:
